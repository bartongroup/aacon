

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Java Library &mdash; AACon 1.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="AACon 1.1 documentation" href="index.html"/>
        <link rel="next" title="Citations" href="citations.html"/>
        <link rel="prev" title="Web Service" href="webservice.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> AACon
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="methods.html">Included Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Standalone Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="webservice.html">Web Service</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Java Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-the-library">Using the library</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-data">Loading data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialising-the-executor">Initialising the executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#normalisation">Normalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-the-conservation-methods">Setting the conservation methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-the-results">Output the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AACon</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Java Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <!-- <a href="_sources/library.rst.txt" rel="nofollow"> View page source</a> -->
            <a href="../">Return to the AACon homepage</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="java-library">
<h1>Java Library<a class="headerlink" href="#java-library" title="Permalink to this headline">¶</a></h1>
<p>This page provides information pertaining to AACon Java library usage.</p>
<hr class="docutils" />
<div class="section" id="using-the-library">
<span id="lib-usage"></span><h2>Using the library<a class="headerlink" href="#using-the-library" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For impatient please find the complete example <a class="reference external" href="library.html#example">below</a>!</p>
</div>
<p>To calculate conservation using AACon follow the steps:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#lib-load"><span class="std std-ref">Loading data</span></a> - Load data</li>
<li><a class="reference internal" href="#lib-init"><span class="std std-ref">Initialising the executor</span></a> - Initialise the executor</li>
<li><a class="reference internal" href="#lib-norm"><span class="std std-ref">Normalisation</span></a> - Decide on normalisation</li>
<li><a class="reference internal" href="#lib-meth"><span class="std std-ref">Setting the conservation methods</span></a> - Set conservation methods</li>
<li><a class="reference internal" href="#lib-output"><span class="std std-ref">Output the results</span></a> - Output the results</li>
</ol>
<p>All these steps are discussed in greater details below.</p>
<hr class="docutils" />
</div>
<div class="section" id="loading-data">
<span id="lib-load"></span><h2>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h2>
<p>AACon methods require a List of FastaSequence objects as input. Below is an example of how to load the Fasta formatted sequence file or the Clustal alignment file. For this call to succeed all the sequences must be of the same length (as this is an alignment).</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">FastaSequence</span><span class="o">&gt;</span> <span class="n">sequences</span> <span class="o">=</span> <span class="n">CmdParser</span><span class="o">.</span><span class="na">openInputStream</span><span class="o">(&lt;</span><span class="n">PATH_TO_INPUT_FILE</span><span class="o">&gt;);</span>
</pre></div>
</div>
<p>For the examples of the input file please see AACon <a class="reference external" href="client.html">standalone executable help page</a>.</p>
<hr class="docutils" />
</div>
<div class="section" id="initialising-the-executor">
<span id="lib-init"></span><h2>Initialising the executor<a class="headerlink" href="#initialising-the-executor" title="Permalink to this headline">¶</a></h2>
<p>AACon methods require the <a class="reference external" href="http://download.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/ExecutorService.html">ExecutorService</a> object which is used to parallel the calculations. The ExecutorService initialised with the number of threads equals to the number of cores on the executing machine is recommended for a faster calculation and can be obtained as follows:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">corenum</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">availableProcessors</span><span class="o">();</span>
<span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">corenum</span><span class="o">);</span>
</pre></div>
</div>
<p>Please take care to initialise and pass only one executor to all the methods to avoid the waist of resources. After use, the executor must be disposed of, it can be done as follows:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</pre></div>
</div>
<hr class="docutils" />
</div>
<div class="section" id="normalisation">
<span id="lib-norm"></span><h2>Normalisation<a class="headerlink" href="#normalisation" title="Permalink to this headline">¶</a></h2>
<p>AACon methods require the boolean parameter telling the system whether the results should be normalised or not. Normalised results have values between 0 and 1. Please note however, that some results cannot be normalised. In such a case, the system returns not normalised values, and log the issue to the standard error stream. The following formula is used for normalisation</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">dmin</span><span class="o">)/(</span><span class="n">dmax</span> <span class="o">-</span> <span class="n">dmin</span><span class="o">)</span>
</pre></div>
</div>
<p>Negative results first converted to positive by adding an absolute value of the most negative result.</p>
<hr class="docutils" />
</div>
<div class="section" id="setting-the-conservation-methods">
<span id="lib-meth"></span><h2>Setting the conservation methods<a class="headerlink" href="#setting-the-conservation-methods" title="Permalink to this headline">¶</a></h2>
<p>AACon <code class="docutils literal"><span class="pre">ConservationCalculator.getConservation()</span></code> method takes a Set of <code class="docutils literal"><span class="pre">ConservationMethod</span></code> to use for calculating the conservation. Below is a few examples of making such sets.</p>
<ul>
<li><p class="first">To calculate conservation according to KABAT method construct a set in the following way -</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">EnumSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">ConservationMethod</span><span class="o">.</span><span class="na">KABAT</span><span class="o">).</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">For all the methods use the following construct -</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">EnumSet</span><span class="o">.</span><span class="na">allOf</span><span class="o">(</span><span class="n">ConservationMethod</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">For a set of methods including KABAT, JORES, SCHNEIDER, SHENKIN and GERSTEIN use the following construct -</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">EnumSet</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="n">ConservationMethod</span><span class="o">.</span><span class="na">KABAT</span><span class="o">,</span> <span class="n">ConservationMethod</span><span class="o">.</span><span class="na">GERSTEIN</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<hr class="docutils" />
</div>
<div class="section" id="output-the-results">
<span id="lib-output"></span><h2>Output the results<a class="headerlink" href="#output-the-results" title="Permalink to this headline">¶</a></h2>
<p>The results can be output using one of the following methods:</p>
<ol class="arabic simple">
<li><em>ConservationFormatter.formatResults(Map&lt;ConservationMethod, double[]&gt; scores, OutputStream outStream)</em></li>
<li><em>ConservationFormatter.formatResults(Map&lt;ConservationMethod, double[]&gt; scores, String outFilePath, Format format, List&lt;FastaSequence&gt; alignment)</em></li>
</ol>
<p>Use the first method to output the results of the calculation without an alignment to any OutputStream. Use the second method to output results with the alignment.</p>
<p>First method usage example:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Usage example - printing results to the console</span>
<span class="n">ConservationFormatter</span><span class="o">.</span><span class="na">outputScoreLine</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">)</span>
<span class="c1">// printing results to the file</span>
<span class="n">FileOutputStream</span> <span class="n">outfile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="s">&quot;results.txt&quot;</span><span class="o">);</span>
<span class="n">ConservationFormatter</span><span class="o">.</span><span class="na">formatResults</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">outfile</span><span class="o">);</span>
<span class="n">outfile</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</pre></div>
</div>
<p>Second method usage example:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Usage example - printing results with alignment in Fasta format to the file called output.txt</span>
<span class="n">ConservationFormatter</span><span class="o">.</span><span class="na">formatResults</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="s">&quot;test.txt&quot;</span><span class="o">,</span> <span class="n">Format</span><span class="o">.</span><span class="na">RESULT_WITH_ALIGNMENT</span><span class="o">,</span> <span class="n">sequences</span><span class="o">);</span>
</pre></div>
</div>
<p>For more information on the output formats please see standalone <a class="reference external" href="client.html#the_output">AACon help</a>.</p>
<hr class="docutils" />
</div>
<div class="section" id="example">
<span id="lib-example"></span><h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Using AACon library for calculating conservation:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Determine the number of CPU cores available on the system.</span>
<span class="kt">int</span> <span class="n">corenum</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">availableProcessors</span><span class="o">();</span>
<span class="c1">// Initialize the Executor instance with a number of cores</span>
<span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">corenum</span><span class="o">);</span>

<span class="c1">// Load the data from the file containing either Clustal formatted alignment</span>
<span class="c1">// or a list of FASTA formatted sequences. Assuming that small.align file is</span>
<span class="c1">// in the same directory as this program</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">FastaSequence</span><span class="o">&gt;</span> <span class="n">sequences</span> <span class="o">=</span> <span class="n">CmdParser</span><span class="o">.</span><span class="na">openInputStream</span><span class="o">(</span><span class="s">&quot;small.align&quot;</span><span class="o">);</span>

<span class="c1">// Calculate conservation scores using all methods.</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">ConservationMethod</span><span class="o">,</span> <span class="kt">double</span><span class="o">[]&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">getConservation</span><span class="o">(</span><span class="n">sequences</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span>
                         <span class="n">EnumSet</span><span class="o">.</span><span class="na">allOf</span><span class="o">(</span><span class="n">ConservationMethod</span><span class="o">.</span><span class="na">class</span><span class="o">)),</span> <span class="n">executor</span><span class="o">);</span>

<span class="c1">// Print the results to the console.</span>
<span class="n">ConservationFormatter</span><span class="o">.</span><span class="na">formatResults</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="citations.html" class="btn btn-neutral float-right" title="Citations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="webservice.html" class="btn btn-neutral" title="Web Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p><a href="../">AACon 1.1</a>
        &copy; Copyright 2018, Agnieszka Golicz, Peter V. Troshin, Fábio Madeira, David M. A. Martin, James B. Procter and Geoffrey J. Barton.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>